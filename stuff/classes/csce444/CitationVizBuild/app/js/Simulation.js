/* jshint -W004, browser: true, devel: true */
/* global doc, THREE, Util, App */

var ATTRACT_FACTOR = 0.000001;
var REPULSE_FACTOR = 0.001;
var SPRING_LENGTH = 2;
var REPULSE_TOUCH_DISTANCE = 30;
var HODOR =  0.001;

/**
 *  Based on user input and whether the nodes are connected
 */
function getRepulseConstant(node1, node2) {
    var constant = 0;
	if (!node1.citations.has(node2.id) && !node1.references.has(node2.id)){
		constant += App.physicsVars.citedByOrReferenced.repulse;
	}
	if (!node1.sharedAuthorPeeps.has(node2.id)){
		constant += App.physicsVars.sharedAuthor.repulse;
	}
	for (var key in node1.sharedKeyWordPeeps){
        //muliple shared keyword makes it stronger
        if (!node1.sharedKeyWordPeeps[key].has(node2.id)){
            constant += App.physicsVars.sharedKeyword.repulse;
        }
    }
    return REPULSE_FACTOR * constant;
}

function makeEdgeLists(graph, keyArray){
	var edges = {
		citedByOrReferenced : [],
		sharedAuthor : [],
		sharedKeyword : []
	};
	for (var i = 0; i < keyArray.length; i++){
		var node1 = graph[keyArray[i]];
		
		for (var j = 0; j < keyArray.length; j++){
			if (i == j) continue;
			
			var node2 = graph[keyArray[j]];
			if (node1.citations.has(node2.id) || node1.references.has(node2.id)){
				edges.citedByOrReferenced.push([i, j].sort());
			}
			if (node1.sharedAuthorPeeps.has(node2.id)){
				edges.sharedAuthor.push([i, j].sort());
			}
			for (var key in node1.sharedKeyWordPeeps){
				//muliple shared keyword do not currently matter.
				if (node1.sharedKeyWordPeeps[key].has(node2.id)){
					edges.sharedKeyword.push([i, j].sort());
				}
			}
		}
	}
	Util.removeDuplicates(edges);
	var notEdges = inverseEdgeList(edges, keyArray);	
	return { list: edges, notList: notEdges};
}

function inverseEdgeList(edges, keyArray){
	var inverse = {};
	for (var key in edges){
		inverse[key] = [];
		for (var i = 0; i < keyArray.length; i++){
			for (var j = i; j < keyArray.length; j++){ //TODO test
				if (i==j) continue;

				if (edges[key].indexOfTuple([i,j]) == -1){
					inverse[key].push([i,j]);
				}
			}			
		}
	}
    //TODO too many edges
	return inverse;
}

function Simulator(nodeMap, keyArray){
    var SPREAD = 50;
	var slowdownAmount = 0.99;
    var bumpAmount = 1;
    
    var startState = [];
    var state_mut1 = [];
	var state_mut2 = [];
	var K1 = [];
	var K2 = [];
	var K3 = [];
	var K4 = [];
	var accels = [];
	var v1_mut = new THREE.Vector3();
	var v2_mut = new THREE.Vector3();
	var v3_mut = new THREE.Vector3();
	var v4_mut = new THREE.Vector3();
	var v5_mut = new THREE.Vector3();
	var v6_mut = new THREE.Vector3();
	var v7_mut = new THREE.Vector3();
	var v8_mut = new THREE.Vector3();
	var disp = new THREE.Vector3();	
	var accel = new THREE.Vector3();	
	
	var size = keyArray.length;
    var mass = 1;

    for (var i=0; i < size * 2; i++){
        startState[i] = new THREE.Vector3(startPositions[i].x, startPositions[i].y, startPositions[i].z);
        //startState[i] = new THREE.Vector3(Util.getRandom(0, SPREAD), Util.getRandom(0, SPREAD), Util.getRandom(0, SPREAD));
        state_mut1[i] = new THREE.Vector3(0,0,0);
		state_mut2[i] = new THREE.Vector3(0,0,0);       
		K1[i] = new THREE.Vector3(0,0,0);  
		K2[i] = new THREE.Vector3(0,0,0);  
		K3[i] = new THREE.Vector3(0,0,0);  
		K4[i] = new THREE.Vector3(0,0,0);
    }
    for (var i=0; i < size; i++){
        startState[i + size] = new THREE.Vector3(0,0,0);
		accels[i] = new THREE.Vector3(0,0,0);  
    }
    var myState = startState.clone();
    
    var simTimeout;       //for starting and stopping the sim
    var clock;
	var fps = 30;
    var H =  1 / fps * 1000; // In milliseconds

	var edges = makeEdgeLists(nodeMap, keyArray); 
	var edgelist = edges.list;
	var notEdgelist = edges.notList;
	
    /** create the sphere and set it according to user inputs, then start simulation and rendering */
    this.start = function(){    
        clock = new THREE.Clock();
        clock.start();
        clock.getDelta();
        window.clearTimeout(simTimeout);
        simulate(startState, slowdownAmount);
    };

	this.getState = function(){
		return myState;
	};
	
    //on input change re-energize the system
    this.bump = function(){
        clearTimeout(simTimeout);
        simTimeout = setTimeout(simulate, H, myState, bumpAmount);
    };
    
    //gets the derivative of a state. plus external forces. returns deep copy of array
    function F(state){
       
        for (var i = 0; i < state.length / 2; i++){
            state_mut1[i].copy(state[i+size]);
        }
		for (var i = 0; i < accels.length; i++){
			accels[i].set(0,0,0);
		}
        
        //USE THE FORCE 
		
		//attractive forces
		for (var key in edgelist){
			for (var l = 0; l < edgelist[key].length; l++){
				var i = edgelist[key][l][0];
				var j = edgelist[key][l][1];
				var node = nodeMap[keyArray[i]];
				var other = nodeMap[keyArray[j]];
				
				if (!node.inFilter || !other.inFilter) continue;
				
                var dist = state[i].distanceTo(state[j]);

                if(isFinite(dist)){
					var rlength = SPRING_LENGTH;
					var k = ATTRACT_FACTOR * App.physicsVars[key].attract;
					
					if (k === 0) continue; //the nodes aren't connected
					var d = 2 * Math.sqrt(k * mass) * 0.5; //make sure damping constant is cool 
					
					v1_mut.copy(state[i]); //x_i
					v2_mut.copy(state[j]); //x_j
					v3_mut.copy(v2_mut).sub(v1_mut); //x_ij
					v4_mut.copy(v3_mut).normalize(); //x_ij_hat

					var force = (dist - rlength) * k;
					v5_mut.copy(v4_mut).multiplyScalar(force); //fs
					
					v8_mut.copy(v5_mut).multiplyScalar(1/mass); //f_s_i / mass
					
					accels[i].add(v8_mut); //spring force
   					accels[j].add(v8_mut.multiplyScalar(-1));
					
					v6_mut.copy(state[j + size]); // v_j
					v6_mut.sub(state[i + size]); //v_j - v_i
					v7_mut.copy(v4_mut).multiplyScalar(v6_mut.dot(v4_mut) * d); 
					
					v8_mut.copy(v7_mut).multiplyScalar(1/mass); //f_s_i / mass
					
					accels[i].add(v8_mut); //damp force
					accels[j].add(v8_mut.multiplyScalar(-1));
                }  				
			}
		}
		
		for (var key in notEdgelist){	
			for (var l = 0; l < notEdgelist[key].length; l++){			
				var i = notEdgelist[key][l][0];
				var j = notEdgelist[key][l][1];
				var node = nodeMap[keyArray[i]];
				var other = nodeMap[keyArray[j]];
								
				if (!node.inFilter || !other.inFilter) continue;
				
                var dist = state[i].distanceTo(state[j]);

                if(dist > 0.5 && dist < REPULSE_TOUCH_DISTANCE){
					var normal = state[i].clone().sub(state[j]).normalize(); //push away from other
                    var force = (REPULSE_FACTOR * App.physicsVars[key].repulse) / (dist*dist*dist); //mass of 1
					
                    accels[i].add(normal.multiplyScalar(force)); 
                    accels[j].add(normal.multiplyScalar(-1)); 
                }			
			}
		}
				
		for (var i = 0; i < size; i++){
			state_mut1[i + size].copy(accels[i]);
		}
		
        return state_mut1;
    }

    function integrateState(state, deriv, timestep){
        deriv.multiply(timestep);
        state.add(deriv);    
    }

    function rk4Integrate(state){
        state_mut2.copy(F(state)); 
        K1 = state_mut2.clone();//K1 = F(Xn)

        //second order deriv
        state_mut2.copy(K1);
        state_mut2.multiply(H * 0.5);
        state_mut2.add(state);
        K2.copy(F(state_mut2)); //K2 = F(Xn + 1/2 * H * K1)

        //third order deriv
        state_mut2.copy(K2);
        state_mut2.multiply(H * 0.5);
        state_mut2.add(state);
        K3.copy(F(state_mut2)); //K3 = F(Xn + 1/2 * H * K2)

        //fourth order deriv
        state_mut2.copy(K3);
        state_mut2.multiply(H);
        state_mut2.add(state);
        K4.copy(F(state_mut2)); //K4 = F(Xn + H * K3)
	 
        K2.multiply(2);
        K3.multiply(2);
        K1.add(K2);
        K1.add(K3);
        K1.add(K4); //Xn+1 = Xn + (K1 + 2*K2 + 2*K3 + K4)/6
		
        integrateState(state, K1, H/6);  
    }

	var tickCount = 0;
	
    /** the main simulation loop. recursive */ 
    function simulate(state, timeFactor){ 
        rk4Integrate(state);

		//have the simulation slowly slow down over time. speeds up otherwise
		for (var i = 0; i < size; i++){
			state[i + size].multiplyScalar(timeFactor);
		} 
		myState.copy(state);
        
        var waitTime = H - clock.getDelta(); 
        if (waitTime < 4){ //4 milliseconds is the minimum wait for most browsers
            console.log("simulation getting behind and slowing down!");
        }
        simTimeout = setTimeout(simulate, waitTime, state, slowdownAmount);
    }
}

var startPositions = [{"x":23.4826021288232,"y":26.018129685223712,"z":39.08964990637576},{"x":13.344506369264609,"y":16.541301111357775,"z":27.325904359728533},{"x":15.555960780535484,"y":24.627606759313938,"z":46.43022802545657},{"x":24.509693933391155,"y":52.712942918640074,"z":16.289789220816683},{"x":9.6275974715601,"y":48.21299495764903,"z":41.00968738309316},{"x":-75.18188378018844,"y":45.25272430652402,"z":19.550386746157404},{"x":22.534857720050226,"y":46.93884596253622,"z":18.825403395424786},{"x":9.559649456100978,"y":46.85948575518808,"z":33.02079925147225},{"x":37.69095846360938,"y":10.95036027728087,"z":17.462616939003155},{"x":38.60734832154274,"y":31.808917709807314,"z":32.1170016855962},{"x":15.35454976178037,"y":118.44008445328555,"z":81.795643735513},{"x":34.624116872682876,"y":28.214480727011303,"z":35.570137837643145},{"x":4.06261571561007,"y":27.78956756178084,"z":4.201186570048175},{"x":17.12438509351472,"y":15.931998482865387,"z":29.143281644341904},{"x":35.55606962872842,"y":13.166397924638643,"z":41.07789185566262},{"x":42.35634812831372,"y":2.5673133075822028,"z":28.83471627122796},{"x":22.215066353391176,"y":44.66703902275836,"z":7.464718606267115},{"x":27.10286360201403,"y":2.1936733799665236,"z":5.768508183705205},{"x":18.628654539141667,"y":39.09952355061612,"z":30.2814555420675},{"x":14.431418299263566,"y":136.1280591060189,"z":162.09325992150664},{"x":35.18772174190454,"y":12.509695146016764,"z":40.51335179448784},{"x":144.16724882489606,"y":34.633541811375515,"z":4.162116605019858},{"x":24.58317915081092,"y":18.674052787458226,"z":40.78788527813793},{"x":42.254050749309215,"y":26.880479167028007,"z":33.71863635455871},{"x":20.311066214285738,"y":49.727651725249736,"z":37.23710173508235},{"x":31.529601359600896,"y":34.196500275522865,"z":-2.9282356956349274},{"x":21.348041372044268,"y":26.71122152222194,"z":29.335331330348932},{"x":10.867847172302865,"y":11.039919598494008,"z":29.68803528464055},{"x":21.997070162287613,"y":67.29945016370735,"z":41.597758205934},{"x":42.23489454915199,"y":23.00478206884315,"z":30.917901156850107},{"x":9.58617772993697,"y":115.19125611728607,"z":78.84173433099174},{"x":40.76068939518113,"y":29.74903033595454,"z":38.80917816633015},{"x":16.112673410827306,"y":3.264661448941231,"z":33.23466748392392},{"x":40.7292421293705,"y":19.10201373730255,"z":25.708942133616535},{"x":41.0089025975778,"y":23.942824114412964,"z":26.415955348734002},{"x":16.634291230688184,"y":27.148597996043318,"z":24.314844205066336},{"x":21.011671409710928,"y":36.99048828829664,"z":25.470586785634655},{"x":14.41784227205475,"y":14.852353575327344,"z":31.179572982394035},{"x":25.042008018383857,"y":17.60521297079501,"z":27.5159653405237},{"x":22.958930533770996,"y":30.407875036902855,"z":36.226495702258774},{"x":10.545156402276012,"y":31.43026397480798,"z":5.991628569770159},{"x":21.427620010128056,"y":58.15347674289711,"z":29.213579818151377},{"x":25.286297545428443,"y":26.86344322099978,"z":25.89934427680109},{"x":3.063488551181497,"y":15.76250773652783,"z":36.362361202877445},{"x":35.551585920240285,"y":7.378000036825322,"z":49.2590271583033},{"x":-110.61383600011371,"y":46.83691478060602,"z":88.63158012502949},{"x":3.3907821064315975,"y":5.145449410926419,"z":5.2059198494890495},{"x":14.336482155149731,"y":9.796715057363487,"z":27.810415333652234},{"x":13.858012478252116,"y":37.92707222462077,"z":27.275062624314284},{"x":21.056033832003603,"y":52.40683312606751,"z":45.78705518299978},{"x":5.408214501807209,"y":14.822776577848773,"z":30.827050379580818},{"x":9.150495674474882,"y":48.24339995743986,"z":24.88542223892936},{"x":33.20880121663679,"y":14.83226086930084,"z":29.405008078185638},{"x":40.64451086314557,"y":17.549545781967023,"z":36.58654515211484},{"x":14.90217934696976,"y":36.39368017830142,"z":13.98411586581738},{"x":29.111764818238903,"y":38.43701009731216,"z":28.793177742965703},{"x":26.82481426525234,"y":28.8246845438848,"z":33.69146047218157},{"x":24.84134807840481,"y":55.745772481130345,"z":44.54092203835657},{"x":40.164453537822205,"y":12.006880428108172,"z":25.322899255495155},{"x":19.08786743167034,"y":20.977636444255022,"z":15.658753959102105},{"x":23.056778034849174,"y":31.279695230550765,"z":32.76385144653627},{"x":36.790538859547794,"y":19.966004936431172,"z":27.86134682264346},{"x":14.128365776924708,"y":4.412358954359299,"z":20.49789874930382},{"x":17.422632120207982,"y":4.071921653093007,"z":25.972064695854662},{"x":87.38832316643298,"y":-56.74895818392136,"z":7.084960009106922},{"x":16.545645431180102,"y":37.0535270924445,"z":23.048360573430408},{"x":21.70028840680224,"y":28.177955035944475,"z":22.87259060412324},{"x":45.070729700099065,"y":25.097011179981862,"z":15.229709112062624},{"x":15.554705720555116,"y":18.575992624668242,"z":25.83277380958984},{"x":6.967126159928656,"y":45.850174293580174,"z":9.091730165301446},{"x":6.019155707714423,"y":19.891094175517264,"z":24.393420624313062},{"x":23.100062305558644,"y":32.62078677547586,"z":21.83882352795894},{"x":11.842666170509728,"y":38.66013195218642,"z":9.194286025230886},{"x":31.188418865459116,"y":14.6681550914599,"z":20.693244865840324},{"x":28.294959102236113,"y":33.904413137366596,"z":24.469341816432102},{"x":-81.34919386921689,"y":7.884262566666924,"z":15.93410245522424},{"x":30.015623249238473,"y":60.503348111803106,"z":42.50061219893838},{"x":24.948422556529984,"y":23.155610626077685,"z":4.155566651797118},{"x":28.20034134827198,"y":21.636644505191732,"z":8.560426656218917},{"x":18.752516245354666,"y":33.25262483674529,"z":22.70417276203398},{"x":7.793357938072061,"y":14.461315374729248,"z":51.994610415191524},{"x":34.17614197685024,"y":16.84353069145496,"z":36.13455853466394},{"x":23.77774073428603,"y":18.172978656918332,"z":6.351708306525366},{"x":31.52246023259116,"y":21.301634343942318,"z":39.39237071599604},{"x":35.51591801592524,"y":23.594816069050037,"z":14.992805815918514},{"x":21.25750796865733,"y":66.57749941557374,"z":-54.70990276341718},{"x":29.931546487643796,"y":30.14621808729103,"z":42.420787326403016},{"x":38.624402866936705,"y":15.038131018336658,"z":28.876814994271335},{"x":33.77631395204358,"y":40.262781671351824,"z":12.117504126678847},{"x":-9.079797970171287,"y":4.344976765588745,"z":36.36371255781988},{"x":6.331762867003935,"y":-4.018449982602363,"z":16.546287465662992},{"x":11.733137405155647,"y":2.6285947877553415,"z":29.707559399950785},{"x":15.892831371282885,"y":29.997575227823738,"z":26.509398103358233},{"x":28.708587773945386,"y":35.60625992621121,"z":33.57015020667475},{"x":23.47548860224129,"y":35.87322300763333,"z":28.189150245388888},{"x":24.609894816737608,"y":63.90082502557105,"z":45.12552692372983},{"x":35.594406332050575,"y":7.401629810399053,"z":34.26524157260967},{"x":29.132564315359915,"y":5.447285660072875,"z":16.932833669052552},{"x":52.12339302604561,"y":28.04949327061562,"z":32.45215404390161},{"x":14.735670613410235,"y":50.386726864981654,"z":17.21222009813035},{"x":27.025268883600123,"y":19.10562618333984,"z":14.589575824525353},{"x":27.978003205165876,"y":6.12122003566684,"z":22.577926702183753},{"x":8.70138529774959,"y":21.442261886616887,"z":39.017470075964006},{"x":60.99477100717183,"y":14.319260532527855,"z":23.524834299382242},{"x":39.06374907199758,"y":4.683886798972585,"z":5.954168689294061},{"x":35.77408292314215,"y":-113.16170413889839,"z":-51.11004376489684},{"x":11.584599045621488,"y":15.755448222030942,"z":41.27711402017622},{"x":34.77769094808508,"y":-9.498847221342137,"z":27.738660558342623},{"x":13.375148273099002,"y":24.94735391188925,"z":12.013872158166468},{"x":32.0113674947108,"y":25.472211678911847,"z":24.08776477598382},{"x":36.6723393846219,"y":20.894402586545326,"z":33.99400005113902},{"x":33.346313309503124,"y":12.265780074473067,"z":13.730727861365605},{"x":16.564125998027322,"y":10.208904964004319,"z":37.29823814233013},{"x":17.981373132344057,"y":29.17348216945605,"z":8.849602842861444},{"x":20.27026905098384,"y":21.120408148755672,"z":22.66331085902536},{"x":24.971314351178282,"y":12.313755489609564,"z":34.771461201409146},{"x":35.862565779872774,"y":25.048576346981246,"z":27.13890014027084},{"x":39.301706313686374,"y":27.217466407338037,"z":14.388363952952925},{"x":12.86100727991058,"y":13.124991942702229,"z":22.574928837453516},{"x":20.132626227335603,"y":9.183995800913399,"z":28.482852190694004},{"x":9.764472843984905,"y":30.978436357309096,"z":25.623184710309726},{"x":16.919347897235532,"y":34.8240658987151,"z":6.341755297231889},{"x":15.5935801854315,"y":-7.980484819343322,"z":18.165683394694163},{"x":34.19952947357068,"y":9.372626016927132,"z":7.223506385919288},{"x":37.73711026829682,"y":38.741969559632516,"z":26.96174067407559},{"x":40.844581943015086,"y":12.22791417151217,"z":36.02820063863547},{"x":45.92377427249747,"y":15.403106268401016,"z":19.54406293107354},{"x":39.44160418885593,"y":35.506640987549204,"z":3.6087634605737833},{"x":-16.700634033425303,"y":54.56836833923409,"z":-40.5281203013176},{"x":32.69242408540677,"y":30.774986125815197,"z":6.82785842753979},{"x":19.825827884487914,"y":45.758770463108014,"z":25.088408993792687},{"x":38.69992118085379,"y":21.335657147912848,"z":40.490074376082916},{"x":34.36727560496472,"y":15.424566821739544,"z":8.328551560508402},{"x":48.74683501303367,"y":15.557856700131898,"z":35.344451039919},{"x":151.6532209580556,"y":-40.01567182585399,"z":92.99315617312698},{"x":45.25795941869217,"y":26.237570895407856,"z":22.15946223305574},{"x":30.818463635394565,"y":18.83651045421059,"z":24.583430389194326},{"x":29.185012575163693,"y":21.675490735829992,"z":34.163240935727345},{"x":48.52085343357351,"y":21.667223343124093,"z":29.019810103011512},{"x":30.18750980668819,"y":24.32610033878673,"z":18.536744310000262},{"x":39.69224466478667,"y":34.43309623521415,"z":22.186181061579582},{"x":38.802213217847424,"y":24.262561984981655,"z":19.821521714398074},{"x":18.313857336891814,"y":28.074874774717358,"z":18.559496519765396},{"x":15.345502344041911,"y":24.152642460825234,"z":20.513509275222372},{"x":42.3567109162081,"y":16.84030933081606,"z":20.06550927158511},{"x":47.5296650954664,"y":18.433719263066276,"z":23.397816245125586},{"x":2.3152359162631146,"y":38.557190242617274,"z":22.04731842209614},{"x":40.97474216359314,"y":-3.2132728815716116,"z":0.02746509289375969},{"x":33.63864983218393,"y":31.526780204649537,"z":28.487607177667297},{"x":38.624760524129606,"y":21.27030240282237,"z":9.582306090754281},{"x":5.400614541696131,"y":11.606461754512653,"z":12.841951210690507},{"x":15.332821868304514,"y":16.967055735219205,"z":9.052642442085686},{"x":4.335048891239902,"y":35.33565993728991,"z":6.569111255714891},{"x":19.9502187521179,"y":10.236108620681142,"z":14.1279148663981},{"x":22.00944783253807,"y":64.64499501241113,"z":34.24133812508162},{"x":43.74026915577188,"y":38.839805070146404,"z":22.52188511899474},{"x":17.596968594620172,"y":26.111386073651165,"z":32.412914006808826},{"x":35.82723399467681,"y":51.61554490210967,"z":28.311453938799524},{"x":42.462536669957146,"y":41.14586536298256,"z":34.33661125623918},{"x":47.22639439068694,"y":23.134250317180406,"z":6.383004974026163},{"x":9.737954212881037,"y":26.932835560779576,"z":24.409763862383954},{"x":22.449744121586672,"y":59.55712344037475,"z":39.29791848321413},{"x":30.451383094909996,"y":37.85637855803033,"z":18.8770405931378},{"x":22.955414103367406,"y":32.84842416725607,"z":9.84528590888898},{"x":48.90453477687642,"y":32.11801881232194,"z":-0.05888569973790221},{"x":52.898828233304634,"y":30.06112613793356,"z":11.318185612746326},{"x":24.492373042667065,"y":22.655977769548596,"z":20.274722567959138},{"x":18.357764207984506,"y":11.9102148230598,"z":21.739258755597845},{"x":45.22360500597269,"y":31.03024161433837,"z":26.787206811207508},{"x":9.484250850439949,"y":7.3708889622691185,"z":34.55389045160609},{"x":43.12314195092498,"y":32.68411383534943,"z":18.85622413343878},{"x":38.60379909199127,"y":19.42538741574631,"z":19.641103591611852},{"x":19.692464394011964,"y":20.660340489798468,"z":28.06502232272483},{"x":-4.333609278052419,"y":16.803300485974106,"z":30.841185156567057},{"x":40.641898806092435,"y":15.202867715649273,"z":42.03821295648686},{"x":48.239387244512486,"y":41.44446890235807,"z":8.724070318723255},{"x":44.96530875750169,"y":14.231099365047573,"z":25.496379372077698},{"x":8.686209601950498,"y":8.508754499872166,"z":22.442051883165366},{"x":33.5071346707136,"y":8.41256624707425,"z":21.911078864062578},{"x":-50.5223262509592,"y":33.785937449137975,"z":112.42280551532484},{"x":25.237274092121247,"y":26.782571612888045,"z":12.051389279538661},{"x":51.143680168453216,"y":14.624490098718686,"z":14.63266576732558},{"x":33.970516041462,"y":-2.796935865974628,"z":2.2590201230295293},{"x":50.919681316931666,"y":39.628930697157216,"z":39.67071348670553},{"x":40.7465157235596,"y":10.78638985558346,"z":7.7099579310426565},{"x":39.787212056678385,"y":31.536728334725446,"z":11.583372911521744},{"x":39.588559039190095,"y":17.170168111383813,"z":10.277202669176727},{"x":50.47747410640055,"y":29.621592204634055,"z":11.198730124440424},{"x":38.64287747095686,"y":19.67431442653201,"z":18.889925062004398},{"x":35.562614405312026,"y":12.94001081091136,"z":-0.04095391598607461},{"x":12.271296395846134,"y":4.114051532475482,"z":4.351571760909651},{"x":43.80588181795374,"y":21.360318922191404,"z":37.3386172908649},{"x":38.955264544506306,"y":36.483676823144606,"z":43.87451207287781},{"x":38.748377550498105,"y":24.789482165154748,"z":1.8560274384353754},{"x":36.27782866423219,"y":30.059224125745878,"z":15.282373825885335},{"x":34.81342248940916,"y":39.3580386199974,"z":39.94289243425966},{"x":-0.5955646473961067,"y":9.164061558262501,"z":33.8532321629529},{"x":26.210630597006,"y":37.04404541135253,"z":12.169982704350582},{"x":33.47811155770299,"y":1.3610104188589316,"z":26.515927979028508},{"x":36.14308259670513,"y":30.837058033467773,"z":21.520619119680035},{"x":13.966943194861264,"y":57.90956257945863,"z":39.4682953124925},{"x":-9.413449264471289e-7,"y":-0.000002501763386604692,"z":-0.000021240788782405172},{"x":-0.00000830589183792495,"y":-0.00002913065439918942,"z":-0.00007019904916136947},{"x":0.0001349954673106501,"y":-0.00002554303746078833,"z":0.00013435746068284456},{"x":-0.00023307133901024428,"y":0.000012124167997589774,"z":-0.0000979119966560144},{"x":0.000005543639491046513,"y":-0.00017375978345874309,"z":0.0000466227826630623},{"x":-4.1135791853290137e-7,"y":8.488329682696713e-8,"z":2.0938029663150295e-8},{"x":-0.00015411372465173523,"y":-0.000022409241747641113,"z":-0.00008436158679532635},{"x":-0.0000844624791993504,"y":0.00001019262199225516,"z":-0.000023023479326742814},{"x":0.00002358140391410078,"y":-0.0001240596321888089,"z":0.00005403028065284631},{"x":-0.00003708944533210919,"y":0.00002435738334378095,"z":-0.0000042097894860939835},{"x":-7.194017906050572e-8,"y":3.97733983842582e-8,"z":8.357483443866841e-7},{"x":-0.000012745693968076293,"y":0.000031502582456557084,"z":0.000024734395750490085},{"x":0.000009160080061767487,"y":-0.00009049914479394015,"z":-0.00004421244179880262},{"x":0.000012552021961048927,"y":-0.0000180431629624501,"z":-0.00004403852754302383},{"x":0.000054589189331470744,"y":0.000008065042173420079,"z":-0.000004856741352489431},{"x":0.00018031105331320135,"y":0.000008979333326966802,"z":-0.00007966038176215694},{"x":-0.00003280850548000696,"y":-0.00004979036304186011,"z":-0.00009048164132596498},{"x":-0.0009092494665519532,"y":-0.0003341463971525834,"z":-0.0002313260241751257},{"x":-0.00006180123358431145,"y":-0.000021743520450020542,"z":-0.00005664963280264225},{"x":-1.0542667245459747e-7,"y":5.886485213614493e-7,"z":6.982549605136505e-7},{"x":0.00006328575764084735,"y":0.000002488698782560371,"z":-0.000008707843700337868},{"x":4.894404853908679e-7,"y":-3.646184158626524e-8,"z":-3.491514429116133e-8},{"x":0.0000065518621256033785,"y":-0.000022413642213226914,"z":-0.00010111331701288642},{"x":-0.000014452579790710014,"y":0.00005492194053063404,"z":0.000010093916277564637},{"x":-0.00008118166932796073,"y":-0.00005177432801325333,"z":-0.00003488166061323493},{"x":0.00012122585481706488,"y":0.00021201680625560366,"z":0.00005345290836787252},{"x":-0.00002218559554026232,"y":-0.000006903952847321037,"z":-0.000042330784709615744},{"x":0.00002121962983256714,"y":-0.000011992893900318029,"z":-0.00001458472494379656},{"x":0.00029255716166995,"y":-0.00008839501545700481,"z":0.000037957539187475595},{"x":-0.000018503531579201822,"y":0.00007251728618989382,"z":3.0178680656211315e-7},{"x":-2.6829316590202826e-8,"y":9.802773148287254e-7,"z":-2.8666510626379e-7},{"x":-0.00001986297612583583,"y":0.00005797040711024491,"z":0.000005655707381834028},{"x":0.0000035530351069702718,"y":-0.000041152233334215056,"z":-0.00006552174858357439},{"x":0.00007783924139095402,"y":0.00011098266072487155,"z":0.000048297448435830355},{"x":-0.0000033650681006404557,"y":0.00001098378094444547,"z":-0.00004847338899830285},{"x":-0.000007411705712452138,"y":0.000014833561428439373,"z":-0.0000913234053875352},{"x":-0.00002825849898944941,"y":-0.000003231624257314031,"z":-0.00005837266220178904},{"x":0.000022060928794635944,"y":-0.000021286130285868383,"z":-0.0000667011694606246},{"x":0.00005040434268659719,"y":0.00006321557784545235,"z":0.00007903589165798295},{"x":-0.00003933439256032596,"y":-0.000006476169892077334,"z":-0.0000249951425273405},{"x":0.00001176232417195104,"y":-0.00007718132431776262,"z":-0.00007207537155583345},{"x":0.00033769059700367173,"y":-0.00005627098799096403,"z":0.000014443609000273622},{"x":-0.000011241595256394256,"y":0.000006990466725263344,"z":-0.000029454404785877685},{"x":0.00012185862920245609,"y":0.00009646298233463205,"z":0.0001168540448262851},{"x":-0.00002276381428238237,"y":0.000021682229736817498,"z":0.000002115699849160144},{"x":-6.709098402429557e-7,"y":1.4481081539633363e-7,"z":3.5641056381828674e-7},{"x":-0.0002460040299447871,"y":0.00038716922241342603,"z":-0.0002958375531875557},{"x":-0.00000986420756094474,"y":-0.000023842588623123428,"z":-0.00006248656164677867},{"x":-0.00003487976555349839,"y":-0.000013778950860722244,"z":-0.00007459564364348913},{"x":-0.00044811619450549854,"y":-0.00003313733692166146,"z":-0.000011990251019024742},{"x":0.00007715704532892583,"y":-0.000031606205202831285,"z":0.0001232053457782137},{"x":-0.000019535879493724276,"y":-0.000038288399546714036,"z":-0.000048256813757897045},{"x":0.00006030591406629237,"y":0.0000030156146301593683,"z":0.000010903253241583986},{"x":0.000023939597912655567,"y":0.000045487688392457966,"z":0.00001225411068667439},{"x":0.000002061687467535837,"y":-0.00004714274676200888,"z":-0.00006912952797525642},{"x":-0.000028402746905915155,"y":0.000007846363432340297,"z":-0.00004563653375634192},{"x":-0.00002699601211322611,"y":0.000010902201843379697,"z":-0.000020659596525616985},{"x":-0.00028433763838489547,"y":-0.00018244232908519516,"z":0.00014844454806217308},{"x":0.00012338136551523618,"y":-0.000085106480028672,"z":0.00017596358051385493},{"x":0.00007898891348120376,"y":0.000017335571609164098,"z":-0.00004336301800651963},{"x":-0.00003047199493283697,"y":-0.000006981627396883314,"z":-0.000041829609795685276},{"x":-0.00001691286448857397,"y":0.000007218955414394205,"z":6.066323542339597e-7},{"x":-0.000008112184286253068,"y":-0.00005212915522164918,"z":0.000040769480857133803},{"x":0.00003573867091410724,"y":-0.000021863400000577603,"z":-0.00001213045904175773},{"x":2.496993911767739e-7,"y":-3.291329321369806e-7,"z":-6.093467114741157e-8},{"x":-0.000023926547258775122,"y":-0.0000170994714881091,"z":-0.00006231084708545346},{"x":-0.0000018997913515463764,"y":-0.000007119536060204132,"z":-0.00004594927501311363},{"x":0.00004461096560840456,"y":0.00017212014612730418,"z":-0.0000723844568436226},{"x":0.000010132889328531047,"y":-0.0000310067313878921,"z":-0.00005774487069080633},{"x":0.00005104241668824814,"y":-0.00005962809327677637,"z":-0.00017477504870312902},{"x":-0.000004742086452859666,"y":0.000030111949814594895,"z":0.0000810085756299517},{"x":-0.000021018117385740747,"y":-0.000002002554797013181,"z":-0.000053835572422544114},{"x":0.00000938732697620778,"y":-0.00007657796549272385,"z":-0.00008442561996761532},{"x":0.00004917281827397492,"y":0.00006072389192251313,"z":-0.000009632464768074587},{"x":-0.00003436076360734943,"y":-0.000012041935600257992,"z":-0.000019419631629070564},{"x":-4.336969568020004e-7,"y":-8.702229310654544e-8,"z":-1.7175574555731518e-8},{"x":-0.00005354382549748253,"y":-0.0003516220091991332,"z":0.0004058252555629262},{"x":0.00032670858941581134,"y":0.00009062066580537508,"z":-0.00007239281703082553},{"x":0.0000769205726133734,"y":0.000012818100215998736,"z":0.000012713576505223156},{"x":-0.000027214008971570784,"y":-0.000020050719395375057,"z":-0.000058385671580799047},{"x":0.0002876385222955988,"y":-0.00030703717368133767,"z":0.0001223660733501227},{"x":0.000023997907402788028,"y":0.000011579537615174798,"z":0.000009538156416098638},{"x":-0.000053170156651312636,"y":0.00019287333751120362,"z":-0.00005382128138687331},{"x":1.565458024826583e-7,"y":0.000007652881841313026,"z":6.76757411904065e-7},{"x":0.000003265931386984901,"y":0.00009144890946340017,"z":-0.000056451039398168354},{"x":-2.923350844982737e-8,"y":1.3452835955859362e-7,"z":-3.040269992626647e-7},{"x":-0.00006912868202269085,"y":0.000029333996297158016,"z":-0.000014327716598162862},{"x":0.0000422836690304956,"y":0.000011030689464617005,"z":0.00005691111203680487},{"x":0.00005182183954342196,"y":-0.00001789329083685067,"z":-0.00003647388864645242},{"x":-0.0002664226600623825,"y":0.0006491320339300192,"z":0.00032304591774002557},{"x":0.00003834556265008581,"y":-0.00014377952579104863,"z":0.0003076742248698574},{"x":-0.000041154865797734084,"y":0.000020692618176656624,"z":-0.00003671150500546192},{"x":-0.0000036600442964312413,"y":-0.000029667934347817953,"z":-0.000034429144965132534},{"x":-0.000048484277233079706,"y":0.000012190776344061413,"z":-0.000041982059559233514},{"x":-0.00004531513081032027,"y":-0.00001320326735199869,"z":-0.00004764627530289054},{"x":-0.00006207335390031289,"y":-0.00020502703903075827,"z":0.00017136933295525963},{"x":0.00012574967657324034,"y":-0.0000029302337828405356,"z":-0.00000966966681792968},{"x":0.00015113856235050814,"y":-0.0001752853162270962,"z":0.00012811264175537984},{"x":-0.000026411940061931014,"y":0.00005772097793266869,"z":0.00002076340318703614},{"x":-0.00010834196513584272,"y":-0.00006213512952630028,"z":-0.000034981313295992125},{"x":0.00007657410932143353,"y":0.000005242421059397858,"z":-0.000015545347420923777},{"x":0.000010850031418436635,"y":0.00004896669426379112,"z":0.00007612614488716395},{"x":0.00027363320803519363,"y":-0.00014017126110038442,"z":0.00020537100701992962},{"x":-0.00006407856724833564,"y":0.00013542828971094216,"z":0.0003713058349242418},{"x":-0.0000696679969434061,"y":-0.00008228735248124816,"z":-0.000050768253382054934},{"x":6.305949087501307e-8,"y":-7.274490994644712e-7,"z":-4.7338296706355657e-7},{"x":0.00019670952419634032,"y":-0.00016457962329757022,"z":0.00011533532031105106},{"x":-0.0003957956650262956,"y":0.000025930707678727716,"z":0.00014624598277852827},{"x":0.00002015261401919677,"y":-0.00006670376935577934,"z":-0.000025760282789964257},{"x":0.0000044621440908790394,"y":0.000009320776781426427,"z":0.000012861633803403572},{"x":0.000022754983839766402,"y":0.000029198094649104107,"z":0.000010986930641716767},{"x":0.00002938601878428481,"y":-0.00003935612575841696,"z":0.00009571329064080545},{"x":0.00009797144427785867,"y":-0.00007542380425844432,"z":-0.00009983494489826446},{"x":0.000004444707868006669,"y":-0.00007530005194440252,"z":-0.00004623067010967683},{"x":0.00003416553971632818,"y":-0.000029611182806482606,"z":-0.000007147498003745181},{"x":0.0000706991679088591,"y":-0.000038033035278024615,"z":-0.00005425566604256821},{"x":-0.0000010666622765868581,"y":-5.99984409252366e-7,"z":-0.000011897597960996554},{"x":0.00004176375172555209,"y":0.00008059713391758706,"z":-0.000019323680803544742},{"x":-0.000014771040514650785,"y":-0.000022876283030887866,"z":-0.00005354209212173093},{"x":-0.000001593837683865942,"y":0.000003871168732266039,"z":-0.000034886830669480206},{"x":-0.000009065259256764611,"y":-0.00002908244112661025,"z":-5.125447289065436e-7},{"x":0.000002268382093464589,"y":-0.00009370970050824853,"z":-0.00007093097928845176},{"x":-0.00011015466288873651,"y":-0.000166404491674497,"z":0.0005342837747141063},{"x":-0.00001612613561969098,"y":-0.00020904139622708674,"z":0.00021948916073438445},{"x":-0.000021556297964280174,"y":-7.596573088518216e-7,"z":-0.000006562917541579784},{"x":0.00009528243419391185,"y":0.000041066121421089535,"z":0.00003321786684454724},{"x":0.001532771762316982,"y":0.0022557600303720416,"z":-0.0003543720795444943},{"x":0.00011981755959851028,"y":-0.00008274513491693096,"z":-0.000009921131199297818},{"x":-1.3731901570451183e-7,"y":9.026356029480291e-8,"z":-2.3010051404506558e-7},{"x":0.00002682147942926049,"y":0.000056728025864221067,"z":-0.00001006674852534159},{"x":0.00001356307016608257,"y":0.000003765454329583569,"z":-0.000014461191202136512},{"x":0.000007882596727373108,"y":0.00004142814989796023,"z":0.00001481897562392007},{"x":-0.0000024260120946089334,"y":-0.00011271889032922548,"z":0.00003484862188431355},{"x":0.00003325004605496295,"y":0.00010183720945718197,"z":0.000028360800517249605},{"x":7.908904698280366e-7,"y":-3.997133348388685e-7,"z":3.7151274779094394e-7},{"x":0.00002536584610225221,"y":0.000018802114381104784,"z":-0.000027827041744372485},{"x":0.000014372237368721537,"y":0.0000029453792234771806,"z":0.00001901669042384675},{"x":0.0000644601535244413,"y":0.00004935462573396166,"z":-0.000027226166661662396},{"x":-0.0000024011449992274593,"y":-0.000005806180223263939,"z":0.00007589018502447387},{"x":0.00002348897863354744,"y":0.00006244908257894838,"z":-0.000008384110675150442},{"x":-0.000014711389575804245,"y":0.000028887118856502626,"z":-0.000004913951239812585},{"x":0.00010400178649613876,"y":0.00003850011752284667,"z":-0.000011250082622681702},{"x":0.000008328969955576589,"y":-0.00004605776786110267,"z":-0.000054528313212743614},{"x":0.000004102555303490446,"y":-0.00005538446422450406,"z":-0.000030127032941840643},{"x":-0.002339638845344218,"y":-0.003870632629571356,"z":0.0008007328255561223},{"x":-0.0002627091702512737,"y":0.000420050995940961,"z":0.00004149556545782557},{"x":0.000031258493092218645,"y":-0.0000645220793133669,"z":0.000004890300996604061},{"x":0.0001551157069520846,"y":-0.00026578685667605475,"z":0.000404136476481842},{"x":-0.000007349073734850195,"y":0.00002005489994761346,"z":-0.00002948056225388976},{"x":0.00006038247932444539,"y":-0.00008915085380768843,"z":0.00001771277857965393},{"x":-0.00014818300606004388,"y":0.00019351484320650634,"z":-0.00006577859177428284},{"x":-0.000015629041213466046,"y":0.00005411039001356076,"z":0.000001595461936565219},{"x":-0.000012311530124337534,"y":-0.0001224717779086886,"z":0.0000401090878418973},{"x":0.00008016706526119468,"y":-0.0000571376534271133,"z":0.00001287248820344957},{"x":0.000472805256211416,"y":-0.00005169408676913865,"z":0.00003196656973706384},{"x":-0.00001820789912610395,"y":0.000028713285076552406,"z":-0.00001622385848062983},{"x":-0.000007342222932223811,"y":-0.00001560931759118173,"z":-0.000023888258585031675},{"x":0.000037599565907806303,"y":0.00001618238881451146,"z":0.000020233799753409752},{"x":-0.00006951895513561869,"y":0.000046092616115323655,"z":0.000003872704850741757},{"x":-0.00013282887862891798,"y":0.00008557808150450176,"z":-0.00012642108970227552},{"x":0.000010165411058101367,"y":-0.00003081852253387629,"z":-8.746637180128041e-7},{"x":0.0000726905050406185,"y":-0.00010502172954360498,"z":0.00003541965396230959},{"x":-0.00001671993744473995,"y":-6.051047847489166e-7,"z":-0.00003267726404211355},{"x":-0.0000053017841979515635,"y":-0.000010528348010228008,"z":-0.00004274179549502282},{"x":0.000047720283890670267,"y":0.00012878546091794492,"z":0.00002431350148283064},{"x":0.000014239906286508171,"y":-0.00005084523841713137,"z":-0.000025019464064056153},{"x":0.00003702309108251002,"y":0.00001476705638117247,"z":-0.00002721300630166418},{"x":0.0000013101158414977836,"y":-0.00002697791690728154,"z":-0.00004501314464610148},{"x":-0.000009591701523501677,"y":0.000024113121124372177,"z":-0.0000017750762407029403},{"x":0.00004815859868964761,"y":0.0000070218014678781984,"z":0.000016750774630399583},{"x":0.000010084788589157579,"y":0.000030980105004936215,"z":0.000004543601151504648},{"x":0.00009502160725733057,"y":0.00041011576464140934,"z":-0.00003896334011987595},{"x":-0.000013310206539232299,"y":-0.000009396746313033016,"z":-0.000046129414525888406},{"x":0.00012275868329522652,"y":0.0001961606198724159,"z":0.00015933010295403083},{"x":0.000027851126314417054,"y":0.00006448811153728598,"z":0.000026275406398229053},{"x":0.00011225101215246081,"y":0.00011845897128362381,"z":0.00032490740822243685},{"x":0.00012955853987333998,"y":0.000006776884257085285,"z":-0.0001126309104008996},{"x":-0.0000097841684800107,"y":0.00001970394290695122,"z":-0.00007197193785789053},{"x":0.00003084823912037388,"y":0.00001925242904921926,"z":0.00009444773243316044},{"x":-3.636903388255759e-7,"y":6.682450178963042e-8,"z":3.8455503562693365e-7},{"x":0.00010253017220107967,"y":0.00006537960874020854,"z":-0.00001668818918572197},{"x":0.0008375801323076012,"y":0.001002877002538904,"z":-0.000236217217878301},{"x":-0.000535476806747788,"y":0.0006415399682275636,"z":-0.0011836992240092813},{"x":-0.0001781256304611892,"y":-0.00002231599393657779,"z":0.0002026625318337454},{"x":0.000020805189853852984,"y":-0.00015417325078815247,"z":0.0001640410790233938},{"x":-0.000006479504402366141,"y":-0.00003486584192277979,"z":-0.00007081804659694038},{"x":0.000011195721503073123,"y":-0.00006156802149134298,"z":0.00004620572511305158},{"x":0.000005767728953282167,"y":-0.00000477245679698592,"z":-0.000031186755363349936},{"x":0.00021319410131110763,"y":0.0002951670587659831,"z":-0.00006977550589012469},{"x":-0.0000495624780996035,"y":-0.00045146006419349095,"z":0.00015592454459386094},{"x":-0.000400655371204105,"y":0.00038889296437740877,"z":-0.0002978422305973304},{"x":0.000005776397365288496,"y":0.00005845871490277538,"z":0.000009546103009332477},{"x":-0.00016175177268298887,"y":0.000016497576552560626,"z":0.000047936663759769855},{"x":-0.000041657624264415495,"y":-0.00011437726250133917,"z":-0.00004296977844103138},{"x":0.00004865766725729682,"y":0.0000505610929200063,"z":0.00001566106519919846},{"x":-0.0001014841770235992,"y":0.00003382969522821563,"z":0.000002281613013102153},{"x":-0.0000027395938941081916,"y":0.0001372212093968106,"z":0.0001305536667818288},{"x":0.000009562824854157724,"y":0.00002003638474493144,"z":-0.00004608044643088038},{"x":0.00007709227610791798,"y":-0.00001629754874576734,"z":-0.000019534181962260194},{"x":-0.0000036454693819980457,"y":0.0000108885852000877,"z":-0.000009488260440515416},{"x":-0.000011477879199624136,"y":0.0001005998130921155,"z":-0.0005199043120390625}];